This file presents sample scripts for using the ebook data in the sqlite3 database table "main" using the Subject headings EBSCO provides in combination with title keywords because many HLM records have no subject headings.

  ---Count number of titles (resources) by vendorname:
  select VendorName , count(vendorname) VendorCount from main group by VendorName order by VendorCount desc;

--- simple subject/title search without using the kbid_subject table, just main:
SELECT * FROM main m WHERE
CASE
 WHEN Title like '%Food%' THEN 1 
 WHEN Title like '%Nutrition%' THEN 1
 WHEN Title like '%Cooking%' THEN 1
 WHEN Subject like '%Nutrition%' THEN 1
 WHEN Subject like '%Restaurants%' THEN 1
 WHEN Subject like '%Food-- Cooking & Entertaining%' THEN 1
 WHEN Subject like '%Foodservice Industry%' THEN 1
 WHEN Subject like '%Frozen Food Industry%' THEN 1
 WHEN Subject like '%Snack Food Industry%' THEN 1
 WHEN Subject like '%SOCIAL SCIENCE / Agriculture & Food%' THEN 1
 WHEN Subject like '%Food Science%' THEN 1
 WHEN Subject like '%BUSINESS & ECONOMICS / Industries / Food Industry%' THEN 1
   END = 1;

-- combining title, subject, and locally-saved LC call numbers for a simple subject count
select kbid, title, managedcoveragebegin, packagename, UPEIAccessNote 
from main 
where 
ResourceType like 'Book' AND
(subject like '%psych%' or title like '%psych%' or callnumber like 'bf%'); -- sqlite3 "like" is case insensitive


--- Simple count of resource types (eg book, journal, video, etc.
select resourcetype, count(resourcetype) from main group by resourcetype;

--- sample script showing join between main and kbid_isbn table
--- Finding holdings records that have neither a subject heading nor a "CallNumber" (actually UserDefinedField5, that UPEI uses to store LC call numbers)
--- but do have at least one ISBN, so hopefully are books
--- you might use this in conjunction with UPEI's Metadata Harvester to find LC call numbers to help in further subject classification of the ebook collection
select distinct ki.kbid, ki.isbn, m.subject, 
m.callnumber, m.PrintISBN, m.OnlineISBN from kbid_isbns ki 
left join main m on ki.kbid = m.KBID 
where m.subject = ''
and m.CallNumber = '' and 
(not m.OnlineISBN  = '' or not m.PrintISBN = '')
and not ki.kbid is null
